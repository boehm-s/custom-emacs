const assignUser = require('../middlewares/isLoggedIn');
const accessControl = require('../middlewares/canModifyOtherId');
const User = require('../models/User');
const Coach = require('../models/Coach');
const Admin = require('../models/Admin');
const compose = require('connect-compose');
const wrapPromise = require('../utils/wrapPromise');
const bodyParser = require('body-parser');
const Bookshelf = require('../bookshelf');

module.exports = compose([bodyParser.urlencoded({extended: true})/*, accessControl(User, [Admin])*/, wrapPromise(async function(req, res, next) {
    const name = req.query.name;
    var result = await User.query(function(qb) {
        qb.where('firstname', 'LIKE', `%${name.toLowerCase()}%`).andWhere('id', '!=', req.user.get('id')).orWhere('lastname', 'LIKE', `%${name.toLowerCase()}%`)
    }).fetchAll()

    return res.json({
        "status": 1,
        "message": "",
        "data" : result.toJSON()
    })
})]);
