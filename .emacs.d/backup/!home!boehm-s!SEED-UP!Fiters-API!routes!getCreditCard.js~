const CreditCard = require('../models/CreditCard');
const compose = require('connect-compose');
const wrapPromise = require('../utils/wrapPromise');
const bodyParser = require('body-parser');
const _ = require('lodash');

module.exports = compose([bodyParser.urlencoded(), wrapPromise(async (req, res, next) => {
    let query = req.query;
    let params = {};

    Object.keys(query).forEach((key, i) => (["fields", "sort"].includes(key)) ? params[key] = query[key].split(',') : params[key] = query[key]);

    try {
        var creditCard = await CreditCard.get({}, params);
    } catch (e) {
        if (e instanceof Error && e.code == 42703)
            return res.status(400).json({status: 0, message: "Error : "+e.message, data: e});
    }

    return res.json({status: 1, message: "", data: creditCard});
})]);
